{"version":3,"sources":["../../src/common/Route.js"],"names":[],"mappings":"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","file":"Route.js","sourcesContent":["import expressJSONSchema from 'express-jsonschema';\nimport Converter from './Converter';\nimport Pipe from 'pipes/build/Pipe';\n\nvar validate = expressJSONSchema.validate;\n\nvar json_schema_error_handler = function(err, req, res, next) {\n\n    if (err.name === 'JsonSchemaValidation') {\n\n        res.status(400);\n\n        var responseData = {\n            message: 'Errors occurred during ' + req.method + ' request to ' + req.url + '.',\n            errors: err.validations\n        };\n\n        if (req.xhr || req.get('Content-Type') === 'application/json') {\n            res.json(responseData);\n        } else {\n            console.log(err.stack);\n            res.send();\n        }\n\n    } else {\n        next(err);\n    }\n}\n\n/**\n * @param {string} method string\n * @param {path} string \n * @param {Framework} fw \n * @param {object} definition \n * @param {Converter} convert \n */\nclass Route {\n\n    constructor(method, path, fw, definition, convert) {\n        this.method = method;\n        this.path = path;\n        this.framework = fw;\n        this.definition = definition;\n        this.convert = convert;\n        this._calls = [path];\n    }\n\n\n    /**\n     * configurePipes uses the pipes library to \n     * squeeze the request bodythrough a pipeline\n     * @param {string} target \n     * @param {object} pipe \n     */\n    configurePipes(target, pipe, pipes) {\n\n        if (!pipe) return this;\n        var p = new Pipe(pipe, pipes);\n        this._calls.push((req, res, next) => {\n            p.run(req[target], function(err, o) {\n                if (err) {\n                    res.status(400);\n                    return res.send();\n                }\n                req[target] = o;\n                next();\n            });\n\n        });\n        return this;\n    }\n\n    /**\n     * configureMiddleware sets up middleware on the route\n     * @param {array} wares \n     */\n    configureMiddleware(wares) {\n\n        if (!wares) return this;\n\n        this.convert.\n        middleware(wares).\n        forEach(mware => {\n            this._calls.push((req, res, next) => {\n                mware(req, res, next, this);\n                next();\n            });\n        });\n\n        return this;\n    }\n\n    /**\n     * configureAction sets up controllers on the route\n     * @param {string} action\n     */\n    configureAction(action) {\n        if (action)\n            this._calls.push((typeof action === 'function') ?\n                action : this.convert.actions(action, this));\n        return this;\n    }\n\n    /**\n     * configureHandler\n     * @param {function} f \n     */\n    configureHandler(f) {\n        if (typeof f === 'function') this._calls.push(f);\n        return this;\n    }\n\n    configureView(view, locals) {\n\n        if (!view) return this;\n        this._calls.push((req, res) => res.render(view, locals));\n        return this;\n\n    }\n\n    /**\n     * configureOther \n     * @param {string} mode \n     * @param {object} definition \n     */\n    configureOther(mode, definition) {\n\n        if (typeof definition === 'string')\n            return this.configureAction(definition);\n\n        if (typeof definition === 'function')\n            this._calls.push(definition);\n\n        return this;\n\n    }\n\n    /**\n     * done queues up the routes\n     */\n    done() {\n        this.framework[this.method].apply(this.framework, this._calls);\n    }\n}\n\nexport default Route;\n"]}