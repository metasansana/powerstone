{"version":3,"sources":["../../src/routing/PipesFeature.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;iCAAiB,qBAAqB;;;;wBAClB,WAAW;;;;;;;;;IAMzB,YAAY;cAAZ,YAAY;;aAAZ,YAAY;8BAAZ,YAAY;;mCAAZ,YAAY;;;iBAAZ,YAAY;;eAEP,iBAAC,MAAM,EAAE,IAAI,EAAE,UAAU,EAAE,CAAC,EAAE;;;AAEjC,gBAAI,CAAC,CAAC;AACN,gBAAI,IAAI,CAAC;AACT,gBAAI,IAAI,CAAC;AACT,gBAAI,SAAS,CAAC;;AAEd,gBAAI,OAAO,UAAU,CAAC,KAAK,KAAK,QAAQ,EAAE,OAAO;;AAEjD,kBAAM,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAC7B,OAAO,CAAC,UAAA,gBAAgB,EAAI;;AAExB,yBAAS,GAAG,UAAU,CAAC,KAAK,CAAC,gBAAgB,CAAC,CAAC;;AAE/C,oBAAI,GAAG,AAAC,OAAO,SAAS,KAAK,QAAQ,GAAI,SAAS,GAC9C,MAAK,WAAW,CAAC,SAAS,CAAC,KAAK,CAAC,OAAO,CAAC,SAAS,CAAC,CAAC;;AAExD,oBAAI,CAAC,IAAI,EACL,MAAM,IAAI,KAAK,CAAC,8BAA2B,SAAS,0CACrB,gBAAgB,SAAI,CAAC,CAAC;;AAEzD,iBAAC,GAAG,mCAAS,IAAI,EAAE,MAAK,WAAW,CAAC,SAAS,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;;AAE7D,iBAAC,CAAC,KAAK,CAAC,MAAM,EAAE,UAAS,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE;;AAErC,qBAAC,CAAC,GAAG,CAAC,GAAG,CAAC,gBAAgB,CAAC,EAAE,UAAS,GAAG,EAAE,CAAC,EAAE;AAC1C,4BAAI,GAAG,EAAE;AACL,+BAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AAChB,mCAAO,GAAG,CAAC,IAAI,EAAE,CAAC;yBACrB;AACD,2BAAG,CAAC,gBAAgB,CAAC,GAAG,CAAC,CAAC;AAC1B,4BAAI,EAAE,CAAC;qBACV,CAAC,CAAC;iBACN,CAAC,CAAC;aACN,CAAC,CAAC;SACN;;;WArCC,YAAY;;;qBAyCH,YAAY","file":"PipesFeature.js","sourcesContent":["import Pipe from 'pipe-transform/Pipe';\nimport Feature from './Feature';\n\n/**\n * PipesFeature installs middleware for the pipes framework\n * on a route.\n */\nclass PipesFeature extends Feature {\n\n    install(method, path, definition, q) {\n\n        var p;\n        var spec;\n        var pipe;\n        var selection;\n\n        if (typeof definition.pipes !== 'object') return;\n\n        Object.keys(definition.pipes).\n        forEach(request_property => {\n\n            selection = definition.pipes[request_property];\n\n            spec = (typeof selection === 'object') ? selection :\n                this.application.framework.pipes.defines[selection];\n\n            if (!spec)\n                throw new Error(`Unknown pipe selection '${selection}' ` +\n                    `decleared for property '${request_property}'!`);\n\n            p = new Pipe(spec, this.application.framework.pipes.filters);\n\n            q.enque(method, function(req, res, next) {\n\n                p.run(req[request_property], function(err, o) {\n                    if (err) {\n                        res.status(409);\n                        return res.send();\n                    }\n                    req[request_property] = o;\n                    next();\n                });\n            });\n        });\n    }\n\n}\n\nexport default PipesFeature\n"]}