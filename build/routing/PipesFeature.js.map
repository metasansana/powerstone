{"version":3,"sources":["../../src/routing/PipesFeature.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;8BAAiB,kBAAkB;;;;wBACf,WAAW;;;;;;;;;IAMzB,YAAY;cAAZ,YAAY;;aAAZ,YAAY;8BAAZ,YAAY;;mCAAZ,YAAY;;;iBAAZ,YAAY;;eAEP,iBAAC,MAAM,EAAE,IAAI,EAAE,UAAU,EAAE,CAAC,EAAE;;;AAEjC,gBAAI,CAAC,CAAC;AACN,gBAAI,IAAI,CAAC;AACT,gBAAI,IAAI,CAAC;;AAET,gBAAI,OAAO,UAAU,CAAC,KAAK,KAAK,QAAQ,EAAE,OAAO;;AAEjD,kBAAM,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAC7B,OAAO,CAAC,UAAA,QAAQ,EAAI;;AAEhB,oBAAI,GAAG,UAAU,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;AAClC,oBAAI,GAAG,MAAK,WAAW,CAAC,SAAS,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,CAAC;;AAEtD,oBAAI,CAAC,IAAI,EACL,MAAM,IAAI,KAAK,qBAAkB,IAAI,kCAA4B,QAAQ,CAAG,CAAC;;AAEjF,iBAAC,GAAG,gCAAS,IAAI,EAAE,MAAK,WAAW,CAAC,SAAS,CAAC,KAAK,CAAC,OAAO,CAAC,CAAC;;AAE7D,iBAAC,CAAC,KAAK,CAAC,MAAM,EAAE,UAAS,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE;;AAErC,qBAAC,CAAC,GAAG,CAAC,GAAG,CAAC,QAAQ,CAAC,EAAE,UAAS,GAAG,EAAE,CAAC,EAAE;AAClC,4BAAI,GAAG,EAAE;AACL,+BAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AAChB,mCAAO,GAAG,CAAC,IAAI,EAAE,CAAC;yBACrB;AACD,2BAAG,CAAC,QAAQ,CAAC,GAAG,CAAC,CAAC;AAClB,4BAAI,EAAE,CAAC;qBACV,CAAC,CAAC;iBACN,CAAC,CAAC;aACN,CAAC,CAAC;SACN;;;WAjCC,YAAY;;;qBAqCH,YAAY","file":"PipesFeature.js","sourcesContent":["import Pipe from 'pipes/build/Pipe';\nimport Feature from './Feature';\n\n/**\n * PipesFeature installs middleware for the pipes framework\n * on a route.\n */\nclass PipesFeature extends Feature {\n\n    install(method, path, definition, q) {\n\n        var p;\n        var spec;\n        var pipe;\n\n        if (typeof definition.pipes !== 'object') return;\n\n        Object.keys(definition.pipes).\n        forEach(property => {\n\n            pipe = definition.pipes[property];\n            spec = this.application.framework.pipes.defines[pipe];\n\n            if (!spec)\n                throw new Error(`Unknown pipe '${pipe}' decleared for property ${property}`);\n\n            p = new Pipe(spec, this.application.framework.pipes.filters);\n\n            q.enque(method, function(req, res, next) {\n\n                p.run(req[property], function(err, o) {\n                    if (err) {\n                        res.status(409);\n                        return res.send();\n                    }\n                    req[property] = o;\n                    next();\n                });\n            });\n        });\n    }\n\n}\n\nexport default PipesFeature\n"]}