{"version":3,"sources":["../../src/test/ManagedServer_test.js"],"names":[],"mappings":"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","file":"ManagedServer_test.js","sourcesContent":["var must = require('must');\nvar supertest = require('supertest');\nvar express = require('express');\nvar http = require('http');\nvar ManagedServer = require('../ManagedServer');\n\nvar server;\nvar app;\nvar request;\nvar impl;\nvar DO_NOT_CLOSE = false;\n\ndescribe('ManagedServer', function () {\n\n    beforeEach(function (done) {\n\n        app = express();\n\n        app.get('/', function (req, res) {\n            res.status(204).send();\n        });\n\n        impl = {\n\n            server: http.createServer(app),\n\n            listen: function () {\n                this.server.listen(7777);\n            },\n\n            on: function () {\n                this.server.on.apply(this.server, arguments);\n            },\n\n            close: function (cb) {\n                this.server.close(cb);\n            }\n        };\n\n        request = supertest(app);\n        server = new ManagedServer(impl);\n        done();\n\n    });\n\n    afterEach(function (done) {\n        if (DO_NOT_CLOSE) return done();\n        return impl.server.close(done);\n    });\n\n    afterEach(function(){\n        DO_NOT_CLOSE = false;\n    });\n\n    it('must be able to start', function (done) {\n        server.start().\n            then(function () {\n                request.get('/').\n                    expect(204).\n                    end(done);\n            });\n    });\n\n    it('must be able to restart', function (done) {\n\n        server.start().\n            then(function (server) {\n                return server.restart();\n            }).\n            then(function () {\n                request.get('/').\n                    expect(204).\n                    end(done);\n            }).\n            catch(done);\n\n    });\n\n    it('must be able to be shutdown', function (done) {\n\n        DO_NOT_CLOSE = true;\n\n        return server.start().\n            then(function (server) {\n                return server.shutdown();\n            }).\n            then(function () {\n                request.get('/').\n                    end(function (err) {\n                        must(true).be.true();\n                        done();\n                    });\n            })\n    })\n});\n"]}