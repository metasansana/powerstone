import Promise from 'bluebird';
import restify from 'restify';
import deep_merge from 'deepmerge';
import Application from '../common/Application';
import ApiModule from './ApiModule';
import Configuration from '../common/Configuration';
import ApiContext from '../api/ApiContext';

function handleException(req, res, next, err) {

    console.error(err.stack);
    res.status(500);
    res.end();
}

class Api extends Application {

    constructor(path) {

        super(path);

        this.main = new ApiModule('', new Configuration('apiconf', path), new ApiContext(), this);

        this.frameworkApp = restify.createServer(this.main.configuration.read('restify', null));
        this.frameworkApp.on('uncaughtException', handleException);
    }

    __createServer() {

        return this.frameworkApp;
    }

}

export default Api;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9hcGkvQXBpLmpzIl0sIm5hbWVzIjpbIlByb21pc2UiLCJyZXN0aWZ5IiwiZGVlcF9tZXJnZSIsIkFwcGxpY2F0aW9uIiwiQXBpTW9kdWxlIiwiQ29uZmlndXJhdGlvbiIsIkFwaUNvbnRleHQiLCJoYW5kbGVFeGNlcHRpb24iLCJyZXEiLCJyZXMiLCJuZXh0IiwiZXJyIiwiY29uc29sZSIsImVycm9yIiwic3RhY2siLCJzdGF0dXMiLCJlbmQiLCJBcGkiLCJjb25zdHJ1Y3RvciIsInBhdGgiLCJtYWluIiwiZnJhbWV3b3JrQXBwIiwiY3JlYXRlU2VydmVyIiwiY29uZmlndXJhdGlvbiIsInJlYWQiLCJvbiIsIl9fY3JlYXRlU2VydmVyIl0sIm1hcHBpbmdzIjoiQUFBQSxPQUFPQSxPQUFQLE1BQW9CLFVBQXBCO0FBQ0EsT0FBT0MsT0FBUCxNQUFvQixTQUFwQjtBQUNBLE9BQU9DLFVBQVAsTUFBdUIsV0FBdkI7QUFDQSxPQUFPQyxXQUFQLE1BQXdCLHVCQUF4QjtBQUNBLE9BQU9DLFNBQVAsTUFBc0IsYUFBdEI7QUFDQSxPQUFPQyxhQUFQLE1BQTBCLHlCQUExQjtBQUNBLE9BQU9DLFVBQVAsTUFBdUIsbUJBQXZCOztBQUVBLFNBQVNDLGVBQVQsQ0FBeUJDLEdBQXpCLEVBQThCQyxHQUE5QixFQUFtQ0MsSUFBbkMsRUFBeUNDLEdBQXpDLEVBQThDOztBQUUxQ0MsWUFBUUMsS0FBUixDQUFjRixJQUFJRyxLQUFsQjtBQUNBTCxRQUFJTSxNQUFKLENBQVcsR0FBWDtBQUNBTixRQUFJTyxHQUFKO0FBRUg7O0FBRUQsTUFBTUMsR0FBTixTQUFrQmQsV0FBbEIsQ0FBOEI7O0FBRTFCZSxnQkFBWUMsSUFBWixFQUFrQjs7QUFFZCxjQUFNQSxJQUFOOztBQUVBLGFBQUtDLElBQUwsR0FBWSxJQUFJaEIsU0FBSixDQUFjLEVBQWQsRUFBa0IsSUFBSUMsYUFBSixDQUFrQixTQUFsQixFQUE2QmMsSUFBN0IsQ0FBbEIsRUFDUixJQUFJYixVQUFKLEVBRFEsRUFDVSxJQURWLENBQVo7O0FBR0EsYUFBS2UsWUFBTCxHQUFvQnBCLFFBQVFxQixZQUFSLENBQXFCLEtBQUtGLElBQUwsQ0FBVUcsYUFBVixDQUF3QkMsSUFBeEIsQ0FBNkIsU0FBN0IsRUFBd0MsSUFBeEMsQ0FBckIsQ0FBcEI7QUFDQSxhQUFLSCxZQUFMLENBQWtCSSxFQUFsQixDQUFxQixtQkFBckIsRUFBMENsQixlQUExQztBQUVIOztBQUVEbUIscUJBQWlCOztBQUViLGVBQU8sS0FBS0wsWUFBWjtBQUVIOztBQWxCeUI7O0FBdUI5QixlQUFlSixHQUFmIiwiZmlsZSI6IkFwaS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBQcm9taXNlIGZyb20gJ2JsdWViaXJkJztcbmltcG9ydCByZXN0aWZ5IGZyb20gJ3Jlc3RpZnknO1xuaW1wb3J0IGRlZXBfbWVyZ2UgZnJvbSAnZGVlcG1lcmdlJztcbmltcG9ydCBBcHBsaWNhdGlvbiBmcm9tICcuLi9jb21tb24vQXBwbGljYXRpb24nO1xuaW1wb3J0IEFwaU1vZHVsZSBmcm9tICcuL0FwaU1vZHVsZSc7XG5pbXBvcnQgQ29uZmlndXJhdGlvbiBmcm9tICcuLi9jb21tb24vQ29uZmlndXJhdGlvbic7XG5pbXBvcnQgQXBpQ29udGV4dCBmcm9tICcuLi9hcGkvQXBpQ29udGV4dCc7XG5cbmZ1bmN0aW9uIGhhbmRsZUV4Y2VwdGlvbihyZXEsIHJlcywgbmV4dCwgZXJyKSB7XG5cbiAgICBjb25zb2xlLmVycm9yKGVyci5zdGFjayk7XG4gICAgcmVzLnN0YXR1cyg1MDApO1xuICAgIHJlcy5lbmQoKTtcblxufVxuXG5jbGFzcyBBcGkgZXh0ZW5kcyBBcHBsaWNhdGlvbiB7XG5cbiAgICBjb25zdHJ1Y3RvcihwYXRoKSB7XG5cbiAgICAgICAgc3VwZXIocGF0aCk7XG5cbiAgICAgICAgdGhpcy5tYWluID0gbmV3IEFwaU1vZHVsZSgnJywgbmV3IENvbmZpZ3VyYXRpb24oJ2FwaWNvbmYnLCBwYXRoKSxcbiAgICAgICAgICAgIG5ldyBBcGlDb250ZXh0KCksIHRoaXMpO1xuXG4gICAgICAgIHRoaXMuZnJhbWV3b3JrQXBwID0gcmVzdGlmeS5jcmVhdGVTZXJ2ZXIodGhpcy5tYWluLmNvbmZpZ3VyYXRpb24ucmVhZCgncmVzdGlmeScsIG51bGwpKTtcbiAgICAgICAgdGhpcy5mcmFtZXdvcmtBcHAub24oJ3VuY2F1Z2h0RXhjZXB0aW9uJywgaGFuZGxlRXhjZXB0aW9uKTtcblxuICAgIH1cblxuICAgIF9fY3JlYXRlU2VydmVyKCkge1xuXG4gICAgICAgIHJldHVybiB0aGlzLmZyYW1ld29ya0FwcDtcblxuICAgIH1cblxuXG59XG5cbmV4cG9ydCBkZWZhdWx0IEFwaVxuIl19