{"version":3,"sources":["../../src/api/Api.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;wBAAoB,UAAU;;;;uBACV,SAAS;;;;yBACN,WAAW;;;;iCACV,uBAAuB;;;;sCAClB,4BAA4B;;;;mCAC/B,yBAAyB;;;;yBAC7B,aAAa;;;;AAEnC,SAAS,eAAe,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,EAAE;;AAE1C,WAAO,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;AACzB,OAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AAChB,OAAG,CAAC,GAAG,EAAE,CAAC;CAEb;;IAEK,GAAG;cAAH,GAAG;;AAEM,aAFT,GAAG,CAEO,IAAI,EAAE;8BAFhB,GAAG;;AAID,mCAJF,GAAG,6CAIK,IAAI,EAAE;AACZ,YAAI,CAAC,IAAI,GAAG,IAAI,SAAS,CAAC,EAAE,EAAE,IAAI,aAAa,CAAC,SAAS,EAAE,IAAI,CAAC,EAAE,IAAI,CAAC,CAAC;AACxE,YAAI,CAAC,YAAY,GAAG,qBAAQ,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,aAAa,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC,CAAC;KAEpG;;iBARC,GAAG;;eAUF,eAAG;;;AAEF,gBAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,CACjC,IAAI,CAAC,YAAM;;AAEP,sBAAK,SAAS,CAAC,OAAO,CAAC,OAAO,GAAG,4BAAW,MAAK,SAAS,CAAC,OAAO,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;AACrF,sBAAK,OAAO,CAAC,IAAI,CAAC,gBAAgB,CAAC,MAAK,SAAS,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;AACnE,sBAAK,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,EAAE,CAAC,aAAa,EAAE,cAAc,CAAC,EAAE,EAAE,CAAC,CAAC;AACvE,sBAAK,YAAY,CAAC,EAAE,CAAC,mBAAmB,EAAE,eAAe,CAAC,CAAC;;AAE3D,sBAAK,MAAM,GAAG,qCACV,MAAK,OAAO,CAAC,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,IAAI,IAAI,IAAI,CAAC,EAClF,MAAK,OAAO,CAAC,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,IAAI,IAAI,SAAS,CAAC,EACvF,wCAAqB,MAAM,CAAC,CAAC,CAAC;;AAElC,uBAAO,MAAK,MAAM,CAAC,KAAK,EAAE,CAAC;aAE9B,CAAC,CACF,IAAI,CAAC,UAAA,IAAI;uBAAI,MAAK,OAAO,CAAC,IAAI,CAAC,MAAK,MAAM,CAAC,OAAO,EAAE,IAAI,QAAO;aAAA,CAAC,SAC3D,CAAC,UAAA,GAAG;uBAAI,MAAK,OAAO,CAAC,IAAI,CAAC,MAAK,MAAM,CAAC,KAAK,EAAE,GAAG,QAAO;aAAA,CAAC,CAAC;SAEjE;;;WA/BC,GAAG","file":"Api.js","sourcesContent":["import Promise from 'bluebird';\nimport restify from 'restify';\nimport deep_merge from 'deepmerge';\nimport Application from '../common/Application';\nimport PowerstoneServer from '../common/PowerstoneServer';\nimport ManagedServer from '../common/ManagedServer';\nimport ApiLoader from './ApiLoader';\n\nfunction handleException(req, res, next, err) {\n\n    console.error(err.stack);\n    res.status(500);\n    res.end();\n\n}\n\nclass Api extends Application {\n\n    constructor(path) {\n\n        super(path);\n        this.main = new ApiModule('', new Configuration('apiconf', path), this);\n        this.frameworkApp = restify.createServer(this.main.configuration.readOrDefault('restify', null));\n\n    }\n\n    run() {\n\n        this.main.load(this.frameworkApp).\n        then(() => {\n\n            this.framework.restify.plugins = deep_merge(this.framework.restify.plugins, plugins);\n            this.modules.main.restifyFramework(this.framework.restify.plugins);\n            this.modules.main.restify(engine, ['body_parser', 'query_parser'], '');\n            this.frameworkApp.on('uncaughtException', handleException);\n\n            this.server = new ManagedServer(\n                this.modules.main.configuration.readWithDefaults('port', process.env.PORT || 3000),\n                this.modules.main.configuration.readWithDefaults('host', process.env.HOST || '0.0.0.0'),\n                new PowerstoneServer(engine));\n\n            return this.server.start();\n\n        }).\n        then(port => this._events.emit(this.events.STARTED, port, this)).\n        catch(err => this._events.emit(this.events.ERROR, err, this));\n\n    }\n\n}\n\nexport default Application\n"]}