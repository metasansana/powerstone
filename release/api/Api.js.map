{"version":3,"sources":["../../src/api/Api.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;wBAAoB,UAAU;;;;uBACV,SAAS;;;;yBACN,WAAW;;;;iCACV,uBAAuB;;;;yBACzB,aAAa;;;;sCACN,4BAA4B;;;;mCAC/B,yBAAyB;;;;mCACzB,yBAAyB;;;;6BAC/B,mBAAmB;;;;AAEvC,SAAS,eAAe,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE,GAAG,EAAE;;AAE1C,WAAO,CAAC,KAAK,CAAC,GAAG,CAAC,KAAK,CAAC,CAAC;AACzB,OAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AAChB,OAAG,CAAC,GAAG,EAAE,CAAC;CAEb;;IAEK,GAAG;cAAH,GAAG;;AAEM,aAFT,GAAG,CAEO,IAAI,EAAE;8BAFhB,GAAG;;AAID,mCAJF,GAAG,6CAIK,IAAI,EAAE;;AAEZ,YAAI,CAAC,IAAI,GAAG,2BAAc,EAAE,EAAE,qCAAkB,SAAS,EAAE,IAAI,CAAC,EAC5D,gCAAa,EAAE,IAAI,CAAC,CAAC;;AAEzB,YAAI,CAAC,YAAY,GAAG,qBAAQ,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,SAAS,EAAE,IAAI,CAAC,CAAC,CAAC;KAE3F;;iBAXC,GAAG;;eAaF,eAAG;;;AAEF,mBAAO,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,CACxC,IAAI,CAAC,YAAM;;AAEP,sBAAK,YAAY,CAAC,EAAE,CAAC,mBAAmB,EAAE,eAAe,CAAC,CAAC;;AAE3D,sBAAK,MAAM,GAAG,qCACV,MAAK,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,IAAI,IAAI,IAAI,CAAC,EAC9D,MAAK,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,IAAI,IAAI,SAAS,CAAC,EACnE,wCAAqB,MAAK,YAAY,CAAC,CAAC,CAAC;;AAE7C,uBAAO,MAAK,MAAM,CAAC,KAAK,EAAE,CAAC;aAE9B,CAAC,CACF,IAAI,CAAC,UAAA,IAAI;uBAAI,OAAO,CAAC,GAAG,CAAC,IAAI,CAAC;aAAA,CAAC,CAAC;SAEnC;;;WA9BC,GAAG;;;qBAkCM,GAAG","file":"Api.js","sourcesContent":["import Promise from 'bluebird';\nimport restify from 'restify';\nimport deep_merge from 'deepmerge';\nimport Application from '../common/Application';\nimport ApiModule from './ApiModule';\nimport PowerstoneServer from '../common/PowerstoneServer';\nimport ManagedServer from '../common/ManagedServer';\nimport Configuration from '../common/Configuration';\nimport Context from '../common/Context';\n\nfunction handleException(req, res, next, err) {\n\n    console.error(err.stack);\n    res.status(500);\n    res.end();\n\n}\n\nclass Api extends Application {\n\n    constructor(path) {\n\n        super(path);\n\n        this.main = new ApiModule('', new Configuration('apiconf', path),\n            new Context(), this);\n\n        this.frameworkApp = restify.createServer(this.main.configuration.read('restify', null));\n\n    }\n\n    run() {\n\n        return this.main.load(this.frameworkApp).\n        then(() => {\n\n            this.frameworkApp.on('uncaughtException', handleException);\n\n            this.server = new ManagedServer(\n                this.main.configuration.read('port', process.env.PORT || 3000),\n                this.main.configuration.read('host', process.env.HOST || '0.0.0.0'),\n                new PowerstoneServer(this.frameworkApp));\n\n            return this.server.start();\n\n        }).\n        then(port => console.log(port));\n\n    }\n\n}\n\nexport default Api\n"]}