{"version":3,"sources":["../../src/web/Application.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;wBAAoB,UAAU;;;;uBACV,SAAS;;;;iCACD,uBAAuB;;;;yBAC5B,WAAW;;;;sCACL,4BAA4B;;;;mCAC/B,yBAAyB;;;;mCACzB,yBAAyB;;;;yBAC7B,aAAa;;;;iCACP,uBAAuB;;IAAvC,UAAU;;AAEtB,IAAM,YAAY,GAAG,CAAC,QAAQ,EAAE,aAAa,EAAE,iBAAiB,EAAE,QAAQ,EACtE,aAAa,EAAE,eAAe,EAAE,SAAS,EAAE,MAAM,CACpD,CAAC;;IAEI,WAAW;cAAX,WAAW;;aAAX,WAAW;8BAAX,WAAW;;mCAAX,WAAW;;;iBAAX,WAAW;;eAEJ,mBAAC,IAAI,EAAE;AACZ,mBAAO,2BAAc,IAAI,IAAI,IAAI,CAAC,IAAI,CAAC,CAAC;SAC3C;;;eAEE,eAAG;;;AAEF,mBAAO,2BART,WAAW,qCAST,IAAI,CAAC,YAAM;;AAEP,oBAAI,GAAG,GAAG,2BAAS,CAAC;;AAEpB,sBAAK,SAAS,CAAC,OAAO,CAAC,UAAU,GAAG,4BAAW,MAAK,SAAS,CAAC,OAAO,CAAC,UAAU,EAC5E,UAAU,CAAC,CAAC;;AAEhB,sBAAK,OAAO,CAAC,IAAI,CAAC,gBAAgB,CAAC,MAAK,SAAS,CAAC,OAAO,CAAC,UAAU,EAChE,MAAK,SAAS,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC;AACpC,sBAAK,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,GAAG,wBAAW,YAAY,CAAC,CAAC;;AAEtD,sBAAK,MAAM,GAAG,qCACV,MAAK,OAAO,CAAC,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,IAAI,IAAI,IAAI,CAAC,EAClF,MAAK,OAAO,CAAC,IAAI,CAAC,aAAa,CAAC,gBAAgB,CAAC,MAAM,EAAE,OAAO,CAAC,GAAG,CAAC,IAAI,IAAI,SAAS,CAAC,EACvF,wCAAqB,iCAAc,eAAe,CAAC,GAAG,EAAE,MAAK,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;;AAEjF,uBAAO,MAAK,MAAM,CAAC,KAAK,EAAE,CAAC;aAE9B,CAAC,CAAC,IAAI,CAAC,UAAA,IAAI;uBAAI,MAAK,OAAO,CAAC,IAAI,CAAC,MAAK,MAAM,CAAC,OAAO,EAAE,IAAI,QAAO;aAAA,CAAC,SAAM,CAAC,UAAA,GAAG;uBAAI,MAAK,OAAO,CAAC,IAAI,CAAC,MAAK,MAAM,CAAC,KAAK,EAAE,GAAG,QAAO;aAAA,CAAC,CAAC;SAErI;;;eAEO,oBAAG;;AAEP,mBAAO,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,CAAC;SAEjC;;;WAnCC,WAAW;;;qBAsCF,WAAW","file":"Application.js","sourcesContent":["import Promise from 'bluebird';\nimport express from 'express';\nimport BaseApplication from '../common/Application';\nimport deep_merge from 'deepmerge';\nimport PowerstoneServer from '../common/PowerstoneServer';\nimport ManagedServer from '../common/ManagedServer';\nimport ServerFactory from '../common/ServerFactory';\nimport WebLoader from './WebLoader';\nimport * as middleware from '../middleware/express';\n\nconst defaultWares = ['public', 'serve-index', 'method-override', 'morgan',\n    'body-parser', 'cookie-parser', 'session', 'csrf'\n];\n\nclass Application extends BaseApplication {\n\n    getLoader(path) {\n        return new WebLoader(path || this.path);\n    }\n\n    run() {\n\n        return super.run().\n        then(() => {\n\n            var app = express();\n\n            this.framework.express.middleware = deep_merge(this.framework.express.middleware,\n                middleware);\n\n            this.modules.main.expressFramework(this.framework.express.middleware,\n                this.framework.express.engines);\n            this.modules.main.express(app, express, defaultWares);\n\n            this.server = new ManagedServer(\n                this.modules.main.configuration.readWithDefaults('port', process.env.PORT || 3000),\n                this.modules.main.configuration.readWithDefaults('host', process.env.HOST || '0.0.0.0'),\n                new PowerstoneServer(ServerFactory.createWebServer(app, this.modules.main)));\n\n            return this.server.start();\n\n        }).then(port => this._events.emit(this.events.STARTED, port, this)).catch(err => this._events.emit(this.events.ERROR, err, this));\n\n    }\n\n    shutdown() {\n\n        return this.server.shutdown();\n\n    }\n}\n\nexport default Application\n"]}