{"version":3,"sources":["../../src/web/WebModule.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;uBAAoB,SAAS;;;;mCACH,yBAAyB;;;;4BAChC,kBAAkB;;;;gCACnB,uBAAuB;;;;AAEzC,IAAM,MAAM,GAAG,EAAE,CAAC;;IAEZ,SAAS;cAAT,SAAS;;AAEA,aAFT,SAAS,CAEC,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,GAAG,EAAE;8BAFtC,SAAS;;AAIP,mCAJF,SAAS,6CAID,IAAI,EAAE,MAAM,EAAE,OAAO,EAAE,GAAG,EAAE;;AAElC,YAAI,CAAC,WAAW,GAAG,2BAAS,CAAC;AAC7B,YAAI,CAAC,eAAe,GAAG,SAAS,CAAC;;AAEjC,YAAI,CAAC,UAAU,GAAG,UAAS,IAAI,EAAE,MAAM,EAAE;;AAErC,mBAAO,SAAS,eAAe,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE;;AAE5C,mBAAG,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,EAAE,UAAS,GAAG,EAAE,IAAI,EAAE;;AAEzC,wBAAI,GAAG,EAAE,IAAI,CAAC,GAAG,CAAC,CAAC;AACnB,uBAAG,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;iBAElB,CAAC,CAAC;aAEN,CAAA;SAEJ,CAAC;KAEL;;iBAxBC,SAAS;;eA0BA,uBAAG;;;AAEV,gBAAI,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,gBAAgB,EAAE,IAAI,CAAC,CAAC;AACrF,gBAAI,QAAQ,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,sBAAsB,EACjF,MAAM,CAAC,CAAC;;AAEZ,oBAAQ,OAAO,MAAM;;AAEjB,qBAAK,UAAU;AACX,0BAAM,CAAC,IAAI,CAAC,WAAW,EAAE,IAAI,CAAC,aAAa,CAAC,CAAA;AAC5C,0BAAM;;AAAA,AAEV,qBAAK,QAAQ;AACT,wBAAI,CAAC,WAAW,CAAC,GAAG,CAAC,OAAO,EACxB,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,eAAe,EAC3D,IAAI,CAAC,aAAa,CAAC,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC;AACzC,wBAAI,CAAC,WAAW,CAAC,GAAG,CAAC,aAAa,EAAE,MAAM,CAAC,CAAC;AAC5C,0BAAM;AAAA,AACV,qBAAK,IAAI;AACL,0BAAM;;AAAA,AAEV;AACI,0BAAM;;AAAA,aAEb;;AAED,kBAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAC,UAAA,GAAG;uBAAI,MAAK,WAAW,CAAC,GAAG,CAAC,GAAG,EAAE,QAAQ,CAAC,GAAG,CAAC,CAAC;aAAA,CAAC,CAAC;AAC/E,gBAAI,CAAC,OAAO,CAAC,WAAW,EAAE,CAAC;SAG9B;;;eAEQ,mBAAC,GAAG,EAAE,QAAQ,EAAE;;AAErB,uCA5DF,SAAS,2CA4DS,IAAI,CAAC,WAAW,EAAE,QAAQ,EAAE;SAE/C;;;eAEQ,mBAAC,KAAK,EAAE,GAAG,EAAE,OAAO,EAAE;;;AAE3B,gBAAI,IAAI,GAAG,IAAI,CAAC,aAAa,CAAC,IAAI,CAAC,iCAAc,IAAI,CAAC,IAAI,QAAM,IAAI,CAAC,IAAI,CAAG,CAAC;AAC7E,gBAAI,MAAM,GAAG,IAAI,CAAC,aAAa,CAAC,MAAM,CAAC,MAAM,CAAC;;AAE9C,kBAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CACnB,OAAO,CAAC,UAAA,KAAK;uBACT,OAAK,MAAM,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,GAAG,CAAC,UAAA,MAAM;2BAC/C,kCAAU,MAAM,EAAE,KAAK,EACnB,OAAO,CAAC,QAAQ,CAAC,MAAM,EAAE,KAAK,EAAE,MAAM,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,CAAC,EACtD,OAAK,WAAW,CAAC;iBAAA,CAAC;aAAA,CAAC,CAAC;;AAEhC,gBAAI,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,EAAE,IAAI,CAAC,WAAW,EAAE,OAAO,CAAC,CAAC;AACxD,eAAG,CAAC,GAAG,CAAC,IAAI,EAAE,IAAI,CAAC,WAAW,CAAC,CAAC;SACnC;;;WA9EC,SAAS;;;qBAkFA,SAAS","file":"WebModule.js","sourcesContent":["import express from 'express';\nimport Configuration from '../common/Configuration';\nimport Module from '../common/Module';\nimport Route from '../common/route/Route';\n\nconst BASKET = {};\n\nclass WebModule extends Module {\n\n    constructor(name, config, context, app) {\n\n        super(name, config, context, app);\n\n        this._expressApp = express();\n        this.configDirectory = 'webconf';\n\n        this.viewEngine = function(view, locals) {\n\n            return function render_web_view(req, res, next) {\n\n                res.render(view, locals, function(err, html) {\n\n                    if (err) next(err);\n                    res.send(html);\n\n                });\n\n            }\n\n        };\n\n    }\n\n    __framework() {\n\n        var engine = this.configuration.read(this.configuration.keys.WEB_VIEWS_ENGINE, null);\n        var settings = this.configuration.read(this.configuration.keys.WEB_FRAMEWORK_SETTINGS,\n            BASKET);\n\n        switch (typeof engine) {\n\n            case 'function':\n                engine(this._expressApp, this.configuration)\n                break;\n\n            case 'string':\n                this._expressApp.set('views',\n                    this.configuration.read(this.configuration.keys.WEB_VIEWS_PATHS,\n                        this.configuration.paths.views));\n                this._expressApp.set('view engine', engine);\n                break;\n            case null:\n                break;\n\n            default:\n                break;\n\n        }\n\n        Object.keys(settings).forEach(key => this._expressApp.set(key, settings[key]));\n        this.modules.__framework();\n\n\n    }\n\n    __filters(app, defaults) {\n\n        super.__filters(this._expressApp, defaults);\n\n    }\n\n    __routing(point, app, actions) {\n\n        var path = this.configuration.read(Configuration.keys.PATH, `/${this.name}`);\n        var routes = this.configuration.routes.routes;\n\n        Object.keys(routes).\n        forEach(route =>\n            this.routes = Object.keys(routes[route]).map(method =>\n                new Route(method, route,\n                    actions.generate(method, route, routes[route][method]),\n                    this._expressApp)));\n\n        this.modules.__routing(path, this._expressApp, actions);\n        app.use(path, this._expressApp);\n    }\n\n}\n\nexport default WebModule\n"]}