{"version":3,"sources":["../../../src/web/filters/CsrfFilter.js"],"names":[],"mappings":";;;;;;;;;;;;qBAAiB,OAAO;;;;;;;;;IAMlB,UAAU;aAAV,UAAU;8BAAV,UAAU;;;iBAAV,UAAU;;eAEP,eAAC,GAAG,EAAE,MAAM,EAAE;;AAEf,gBAAI,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,oBAAoB,EAAE,KAAK,CAAC,EAAE;;AAElD,mBAAG,CAAC,GAAG,CAAC,wBAAK,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,oBAAoB,EAAE;AACvD,0BAAM,EAAE,IAAI;iBACf,CAAC,CAAC,CAAC,CAAC;;AAEL,mBAAG,CAAC,GAAG,CAAC,SAAS,eAAe,CAAC,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE;;AAE7C,uBAAG,CAAC,GAAG,CAAC,cAAc,EAAE,GAAG,CAAC,SAAS,EAAE,CAAC,CAAC;AACzC,uBAAG,CAAC,MAAM,CAAC,cAAc,EAAE,GAAG,CAAC,SAAS,EAAE,CAAC,CAAC;AAC5C,uBAAG,CAAC,MAAM,CAAC,KAAK,GAAG,GAAG,CAAC,SAAS,EAAE,CAAC;AACnC,wBAAI,EAAE,CAAC;iBAEV,CAAC,CAAC;;;AAGH,mBAAG,CAAC,GAAG,CAAC,SAAS,aAAa,CAAC,GAAG,EAAE,GAAG,EAAE,GAAG,EAAE,IAAI,EAAE;;AAEhD,wBAAI,GAAG,CAAC,IAAI,KAAK,eAAe,EAAE,OAAO,IAAI,CAAC,GAAG,CAAC,CAAC;AACnD,uBAAG,CAAC,MAAM,CAAC,GAAG,CAAC,CAAC;AAChB,uBAAG,CAAC,IAAI,CAAC,eAAe,CAAC,CAAC;iBAE7B,CAAC,CAAC;aAEN;SACJ;;;WA7BH,UAAU;;;qBAgCG,IAAI,UAAU,EAAE","file":"CsrfFilter.js","sourcesContent":["import csrf from 'csurf';\n\n/**\n * CsrfFilter \n * @implements {Filter}\n */\nclass CsrfFilter {\n\n    apply(app, config) {\n\n        if (config.read(config.keys.FILTERS_CSRF_ENABLED, false)) {\n\n                app.use(csrf(config.read(config.keys.FILTERS_CSRF_OPTIONS, {\n                    cookie: true\n                })));\n\n                app.use(function send_csrf_token(req, res, next) {\n\n                    res.set('x-csrf-token', req.csrfToken());\n                    res.cookie('x-csrf-token', req.csrfToken());\n                    res.locals._csrf = req.csrfToken();\n                    next();\n\n                });\n\n                //TODO allow client code to hook into this instead of this lame handler\n                app.use(function if_csrf_error(err, req, res, next) {\n\n                    if (err.code !== 'EBADCSRFTOKEN') return next(err);\n                    res.status(403);\n                    res.send('INVALID TOKEN');\n\n                });\n\n            }\n        }\n    }\n\n    export default new CsrfFilter()\n"]}